## TCP/IP基础知识

### 2.3 基础知识

* 传输协议：TCP、UDP
* 网际协议：IP、ICMP、ARP
* 路由控制协议：RIP、OSPF、BGP
* 应用协议：HTTP、SMTP、FTP、TELNET、SNMP

`Internet`：网际网
`The Internet`：互联网

### 2.4 TCP/IP协议分层模型

* 物理层
* 数据链路层
* 网络层

	网络层使用IP协议，基于IP地址转发分包数据，连接互联网的所有主机和路由器都必须实现IP功能。

	* IP

		IP协议使用IP地址作为主机的标识，将数据包跨越网络传递到接收端

		IP协议中隐含数据链路层功能，通过IP协议，相互通信的主机之间不论经过怎样的底层数据链路都能实现通信

		IP协议是不可靠传输协议，不具有重发机制，即使分组数据包传输失败也不会重发

	* ICMP

		用于当IP数据包无法到达对端地址时给发送端一个异常通知，也被用于诊断网络的健康状况（ping）

	* ARP

		从分组数据包的IP地址中解析出物理地址（MAC地址）的一种协议

* 传输层

	传输层主要功能为实现应用程序之间的通信，计算机内部，不同应用程序占用不同的端口号，传输层根据端口号进行区分

	* TCP

		面向有连接的传输层协议，保证两端通信主机之间的通信可达。能够正确处理丢包、乱序等情况，可以有效利用带宽，缓解网络拥堵

		但是为了保证可靠性，造成了网络流量的浪费，定义了大量复杂规则，不利于部分情况下的使用

	* UDP

		面向无连接的传输层协议，不关注对方是否真正收到数据，常应用与分组数据较少或多播、广播以及视频通信等多媒体领域

* 应用层

	HTTP：HyperText Transfer Protocol，应用层协议

	HTML：HyperText Markup Language，表示层协议

### 2.5 TCP/IP通信示例

#### 2.5.1 数据包首部

数据报由首部加上层数据组成。

每个分层中都会对所发送的数据附加一个首部，首部中包含了该层的必要信息。下一层丛上一层接收到的包全部被认为是本层的数据

* 包：所有的数据都可以用包来称呼
* 帧：数据链路层中包的单位
* 数据报：IP和UDP等网络层以上分层中包的单位
* 段：TCP数据流中的信息
* 消息：应用协议中数据的单位

#### 2.5.2 发送数据包

1. 应用程序将数据交给TCP层
2. TCP模块处理：根据应用层指示，负责建立连接、发送数据以及断开连接

	在应用层数据前端增加**TCP首部**，其中包括源端口号和目标端口号（TCP层使用端口号区分应用）、序号（当前发送数据在发送端整体数据中的序列号）和校验和（用于判断数据是否被损坏），再将整个包交给IP层

3. IP模块处理

	在TCP首部前端增加**IP首部**，其中包含接收端IP地址以及发送端IP地址。紧跟IP首部的数据用于标志后面数据使用了TCP还是UDP协议，之后将整个包交给数据链路层

4. 数据链路层处理

	数据链路层在接收到的数据之前加上**以太网首部**，其中包含接收端和发送端的MAC地址以及标志以太网类型的以太网数据协议。

以太网数据报 将通过物理层传输给接收端。发送处理中将进行FCS计算，添加到包的最后，用于判断数据包是否被破坏

#### 2.5.3 分组数据包

每个包首部都至少会包含两个信息：一个是发送端与接收端的地址，一个是上一层的协议类型

#### 2.5.4 数据包接收处理

包的接收程序是发送程序的逆序过程

特点在于会从包首部中取出地址检查是否与自己的地址相匹配，如果匹配，则接收数据并查找上一层的协议，然后将其交给相应的程序处理

### 