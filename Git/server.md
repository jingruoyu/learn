# 服务器上的Git

与他人合作的最佳方法即为建立一个你与合作者们都有权利访问，且可以从那里pull和push数据的公用仓库

一个远程repo通常只是一个bare repository，即一个没有当前工作目录的仓库。因为该仓库仅仅是一个合作媒介，不需要从磁盘检查快照，存放的只有Git的资料。

**裸仓库就是工程目录中.git子目录内容，不包含其他数据**

## 协议

Git可以使用四种不同的协议来传输数据

* 本地协议Local
* HTTP协议
* SSH（Secure Shell）
* Git协议

### 本地协议

本地协议的远程版本库就是同一主机上的另一个目录，常用于团队每个成员都对一个共享文件系统（如一个挂载的NFS）拥有访问权，或者多人公用一台电脑的情况

使用共享文件系统时，可以从本地版本库clone、push或者pull

```
git clone /srv/git/project.git
// 或者
git clone file:///srv/git/project.git
```

当URL明确指定file协议，Git的行为会略有不同

* 如果仅是指定路径，Git会尝试使用硬链接hard link或直接复制所需要的数据
* 如果制定了file协议，Git会触发平时用于网络传输资料的进程，**传输效率会变低**

指定file协议的主要目的是取得一个没有`extraneous references`或`Object`的干净版本库副本，通常是在从其他版本控制系统导入后或一些类似的情况下需要这么做

#### 优点

基于文件系统的版本库相对比较简单，并且直接使用了现有的文件权限和网络访问权限。如果团队已经有共享文件系统，建立版本库会十分容易。将一个空repo放入到共享文件夹，设计读写权限即可

#### 缺点

共享文件夹比较难配置，必须先挂在一个远程磁盘，相较于网络连接的访问方式，配置不方便

**此外如果适用类似于共享挂在的文件系统时，速度不一定是最快的。**访问本地版本库的速度与访问数据的速度是一样的

在同一个服务器上，如果允许Git访问本地硬盘，一般通过NFS访问版本库的速度比SSH访问慢

每个用户都有远程目录的完整shell权限，没有方法可以阻止他们修改或删除Git内部数据或损坏仓库

### HTTP协议

Git中的HTTP通信有两种

* Dumb HTTP：Git 1.6.6版本之前使用

	如果服务器没有提供智能HTTTP服务，Git客户端会尝试使用更简单的`Dumb HTTP`。

	`Dumb HTTP`协议中web服务器仅把空repo当做普通文件看待，其优美之处在于设置起来很简单

* Smart HTTP：Git 1.6.6版本引入

	运行方式和`SSH`以及`Git`协议类似，只是运行在标准的`HTTP/S`端口上并且可以使用各种`HTTP`验证机制。使用起来会比`SSH`协议简单很多，如可以使用`HTTP`协议既有的授权方式

	Smart HTTP可以只使用一个URL
	* 支持`git://`协议一样设置匿名服务
	* 支持`SSH`协议一样提供传输时的授权和加密

	当把数据push到一个需要授权的服务器上时，服务器会提示输入用户名和密码

#### 优点

针对smart HTTP

* 不同的访问方式只需要一个URL
* 服务器只在需要授权时提示输入授权信息

这两个简便性使得Git变得非常简单。相较于SSH协议，第二点避免了SSH密钥对的生成及公钥的上传，对于一些使用者来说具备很大优势

此外HTTPS协议被广泛使用，一般企业防火墙都允许通过

#### 缺点

在服务器上架设HTTPS协议的服务端比SSH更棘手一些

如果在HTTP上使用需要授权的push，相较于SSH管理凭证较为麻烦，但可以借助于一些系统凭证管理器，macOS与windows均有对应工具

### SSH 协议